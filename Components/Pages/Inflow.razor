@page "/inflow"
@using MyPocketTrack.Components.Models
@using MyPocketTrack.Components.Services
@inject TransactionService TransactionService
@inject ISnackbar Snackbar

<div class="container-fluid p-4">
    <!-- Summary Card -->
    <div class="row">
        <div class="col-12 col-md-4 mb-4">
            <div class="card shadow text-center" style="background: linear-gradient(135deg, #1d976c, #93f9b9); color: white;">
                <div class="card-body">
                    <h5 class="card-title">Total Inflow</h5>
                    <p class="card-text display-6">@TransactionService.TotalInflow.ToString("C")</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4 mb-4">
            <div class="card shadow text-center" style="background: linear-gradient(135deg, #3b8d99, #6b9080); color: white;">
                <div class="card-body">
                    <h5 class="card-title">Number of Inflow Transactions</h5>
                    <p class="card-text display-6">@TransactionService.TotalInflowCount</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Transactions -->
    <div class="row">
        <!-- Top 5 Highest Inflows -->
        <div class="col-12 col-md-6 mb-4">
            <MudPaper Elevation="3" Class="p-4">
                <MudTable Items="@TopHighestInflows" Dense="true" Hover="true" Bordered="true" Striped="true">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Top 5 Highest Inflows</MudText>
                    </ToolBarContent>
                    <HeaderContent>
                        <MudTh>Amount</MudTh>
                        <MudTh>Source</MudTh>
                        <MudTh>Description</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.Amount.ToString("C")</MudTd>
                        <MudTd>@context.Source</MudTd>
                        <MudTd>@context.Description</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </div>

        <!-- Top 5 Lowest Inflows -->
        <div class="col-12 col-md-6 mb-4">
            <MudPaper Elevation="3" Class="p-4">
                <MudTable Items="@TopLowestInflows" Dense="true" Hover="true" Bordered="true" Striped="true">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Top 5 Lowest Inflows</MudText>
                    </ToolBarContent>
                    <HeaderContent>
                        <MudTh>Amount</MudTh>
                        <MudTh>Source</MudTh>
                        <MudTh>Description</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.Amount.ToString("C")</MudTd>
                        <MudTd>@context.Source</MudTd>
                        <MudTd>@context.Description</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </div>
    </div>
</div>

@code {
    private IEnumerable<Transaction> TopHighestInflows => TransactionService.GetTransactions()
        .Where(t => t.Type == TransactionsStatus.Inflow)
        .OrderByDescending(t => t.Amount)
        .Take(5);

    private IEnumerable<Transaction> TopLowestInflows => TransactionService.GetTransactions()
        .Where(t => t.Type == TransactionsStatus.Inflow)
        .OrderBy(t => t.Amount)
        .Take(5);
}
